<!DOCTYPE html>
<html>
<head>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}

.action_button{
    display:inline-block;
    width: 80px;
    height: 40px;
}
</style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

<h1>Kupcy Baniaka</h1>

<button id="generate_button">Generuj</button><br><br>


<span>Gotówka kupca: <span id="merchant_cash"></span></span>


<h2> Kupiec oferuje</h2>
<table>
  <tr>
    <th>Towar</th>
    <th>Cena rynkowa (za sztukę)</th>
    <th>Cena rzeczywista (za sztukę)</th>
    <th>Dostępność (w sztukach)</th>
  </tr>
  <tr>
    <td id="s0_name"></td>
    <td id="s0_market_price"></td>
    <td id="s0_price"></td>
    <td id="s0_quantity"></td>
  </tr>
  <tr>
    <td id="s1_name"></td>
    <td id="s1_market_price"></td>
    <td id="s1_price"></td>
    <td id="s1_quantity"></td>
  </tr>
  <tr>
    <td id="s2_name"></td>
    <td id="s2_market_price"></td>
    <td id="s2_price"></td>
    <td id="s2_quantity"></td>
  </tr>
  <tr>
    <td id="s3_name"></td>
    <td id="s3_market_price"></td>
    <td id="s3_price"></td>
    <td id="s3_quantity"></td>
  </tr>
  <tr>
    <td id="s4_name"></td>
    <td id="s4_market_price"></td>
    <td id="s4_price"></td>
    <td id="s4_quantity"></td>
  </tr>
  <tr>
    <td id="s5_name"></td>
    <td id="s5_market_price"></td>
    <td id="s5_price"></td>
    <td id="s5_quantity"></td>
  </tr>

</table>

<h2>Kupiec chce kupić</h2>
<table>
  <tr>
    <th>Towar</th>
    <th>Cena rynkowa (maksymalna za sztukę)</th>
    <th>Cena rzeczywista (maksymalna za sztukę)</th>
    <th>Ilość (w sztukach)</th>
  </tr>
  <tr>
    <td id="b0_name"></td>
    <td id="b0_market_price"></td>
    <td id="b0_price"></td>
    <td id="b0_quantity"></td>
  </tr>
  <tr>
    <td id="b1_name"></td>
    <td id="b1_market_price"></td>
    <td id="b1_price"></td>
    <td id="b1_quantity"></td>
  </tr>
  <tr>
    <td id="b2_name"></td>
    <td id="b2_market_price"></td>
    <td id="b2_price"></td>
    <td id="b2_quantity"></td>
  </tr>
  <tr>
    <td id="b3_name"></td>
    <td id="b3_market_price"></td>
    <td id="b3_price"></td>
    <td id="b3_quantity"></td>
  </tr>
  <tr>
    <td id="b4_name"></td>
    <td id="b4_market_price"></td>
    <td id="b4_price"></td>
    <td id="b4_quantity"></td>
  </tr>
  <tr>
    <td id="b5_name"></td>
    <td id="b5_market_price"></td>
    <td id="b5_price"></td>
    <td id="b5_quantity"></td>
  </tr>
</table>

<h2>Kalkulator</h2>
<div class="checkout">
  <p class="description">Towar: <span id="calculator_item_name"></span></p>
  <p class="description">Cena: <span id="calculator_price_display"></span></p>
  <p class="description">Ilość:</p>
  <button type="button" class="decrease-btn">-</button>
  <input type="text" class="quantity" id="calculator_quantity" value="0">
  <button type="button" class="increase-btn">+</button>
  <p class="total">Cena: <span id="total">0</span></p>
</div>

</body>
<script>

  function randomIntFromInterval(min, max) { // min and max included
    return Math.floor(Math.random() * (max - min + 1) + min)
  }

  const callMerchantApi = async () => {
    document.getElementById("merchant_cash").textContent = randomIntFromInterval(500, 2000) + "";

    const response = await fetch(
            'https://karolkrych.pythonanywhere.com/',
            {
              headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "https://kkrych.github.io",
              }
            }
    );



    const myJson = await response.json(); //extract JSON from the http response
    // do something with myJson

    for (let i = 0; i < 6; i++) {
      let price = "<span id=\"s" + i + "_real_price\">" + myJson.for_sell[i].real_price + "</span>" + " (" + myJson.for_sell[i].market_price + " <b>" + myJson.for_sell[i].modifier_display + "</b>)";
      document.getElementById("s" + i + "_name").textContent = myJson.for_sell[i].name;
      document.getElementById("s" + i + "_market_price").textContent = myJson.for_sell[i].market_price;
      document.getElementById("s" + i + "_price").innerHTML = price;
      document.getElementById("s" + i + "_quantity").textContent = myJson.for_sell[i].quantity;

      document.getElementById("s" + i + "_name").addEventListener("click", function () {
        document.getElementById("calculator_item_name").textContent = document.getElementById("s" + i + "_name").textContent;
        document.getElementById("calculator_price_display").textContent = document.getElementById("s" + i + "_real_price").textContent;
        document.getElementById("calculator_quantity").value = '0';
        document.getElementById("total").textContent = '0';
      });

    }

    for (let i = 0; i < 6; i++) {
      let price = "<span id=\"b" + i + "_real_price\">" + myJson.for_sell[i].real_price + "</span>" + " (" + myJson.for_sell[i].market_price + " <b>" + myJson.for_sell[i].modifier_display + "</b>)";
      document.getElementById("b" + i + "_name").textContent = myJson.buy_offers[i].name;
      document.getElementById("b" + i + "_market_price").textContent = myJson.buy_offers[i].market_price;
      document.getElementById("b" + i + "_price").innerHTML = price;
      document.getElementById("b" + i + "_quantity").textContent = myJson.buy_offers[i].quantity;

      document.getElementById("b" + i + "_name").addEventListener("click", function () {
        document.getElementById("calculator_item_name").textContent = document.getElementById("b" + i + "_name").textContent;
        document.getElementById("calculator_price_display").textContent = document.getElementById("b" + i + "_real_price").textContent;
        document.getElementById("calculator_quantity").value = '0';
        document.getElementById("total").textContent = '0';
      });

    }
  }

  document.getElementById("generate_button").addEventListener("click", callMerchantApi);

  // calculator
  $(document).ready(function() {
  $(".checkout").on("input", ".quantity", function() {
    var price = +parseFloat($("#calculator_price_display")[0].innerText);
    var quantity = +$(this).val();
    $("#total").text((price * quantity).toFixed(2) + "");
  })

  var $buttonPlus = $('.increase-btn');
  var $buttonMin = $('.decrease-btn');
  var $quantity = $('.quantity');

  /*For plus and minus buttons*/
  $buttonPlus.click(function() {
    $quantity.val(parseInt($quantity.val()) + 1).trigger('input');
  });

  $buttonMin.click(function() {
    $quantity.val(Math.max(parseInt($quantity.val()) - 1, 0)).trigger('input');
  });
})

</script>
</html>


